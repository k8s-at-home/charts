{{- $values := .Values.webhook.service -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "common.names.fullname" . }}-webhook
  labels:
    {{- include "common.labels" . | nindent 4 }}
  {{- if $values.labels }}
    {{ toYaml $values.labels | nindent 4 }}
  {{- end }}
  annotations:
  {{- if eq ( $values.protocol | default "" ) "HTTPS" }}
    traefik.ingress.kubernetes.io/service.serversscheme: https
  {{- end }}
  {{- with $values.annotations }}
    {{ toYaml . | nindent 4 }}
  {{- end }}
spec:
  type: ClusterIP
  {{- if $values.clusterIP }}
  clusterIP: {{ $values.clusterIP }}
  {{end}}
  {{- if $values.sessionAffinity }}
  sessionAffinity: {{ $values.sessionAffinity }}
  {{- if $values.sessionAffinityConfig }}
  sessionAffinityConfig:
    {{ toYaml $values.sessionAffinityConfig | nindent 4 }}
  {{- end -}}
  {{- end }}
  ports:
    - name: http
      protocol: TCP
      port: {{ $values.port }}
      targetPort: http
  selector:
    {{- include "pod-gateway.labels.selectorLabels" . | nindent 4 }}
