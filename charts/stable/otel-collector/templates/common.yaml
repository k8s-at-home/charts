{{/* Make sure all variables are set properly */}}
{{- include "common.values.setup" . }}

{{- define "otel-collector.configVolume" -}}
{{/* Append the secret volume to the volumes */}}
enabled: true
mountPath: "/conf/otel-collector-config.yaml"
subPath: "otelConfigFile"
type: "custom"
volumeSpec:
  secret:
    {{- if .Values.configFileSecret }}
    secretName: "{{ .Values.configSecretName }}"
    {{- else }}
    secretName: "{{ include "common.names.fullname" . }}-otelconfig"
    {{- end }}
{{- end -}}
{{- $_ := set .Values.persistence "otel-config-file" (include "otel-collector.configVolume" . | fromYaml) -}}

{{ include "common.all" . }}
