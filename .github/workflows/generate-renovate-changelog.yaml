name: "Charts: Update changelog for Renovate PR"

concurrency: update-renovate-pr-changelog

on:
  pull_request:
    paths:
    - 'charts/**'

jobs:
  update-changelog:
    name: Update changelog
    runs-on: ubuntu-20.04

    # if: startsWith(github.ref, 'refs/heads/test/')

    steps:
      - name: Run against changed charts
        if: steps.filter.outputs.addedOrModified == 'true'
        run: |
          echo $GITHUB_REF

      # - name: Checkout
      #   uses: actions/checkout@v2
      #   with:
      #     fetch-depth: 2

      # - uses: dorny/paths-filter@v2
      #   id: filter
      #   with:
      #     base: ${{ github.ref }}
      #     list-files: shell
      #     filters: |
      #       addedOrModified:
      #         - added|modified: 'charts/**'

      # - name: Run against changed charts
      #   if: steps.filter.outputs.addedOrModified == 'true'
      #   run: |
      #     CHARTS=()
      #     PATHS=(${{ steps.filter.outputs.addedOrModified_files }})
      #     # Get only the chart paths
      #     for i in "${PATHS[@]}"
      #     do
      #         IFS='/' read -r -a path_parts <<< "$i"
      #         CHARTS+=("${path_parts[1]}/${path_parts[2]}")
      #     done

      #     # Remove duplicates
      #     CHARTS=( `for i in ${CHARTS[@]}; do echo $i; done | sort -u` )

      #     for i in "${CHARTS[@]}"
      #     do
      #         echo "Updating CHANGELOG for chart ${i}"
      #         IFS='/' read -r -a chart_parts <<< "$i"
      #         if [ -f "charts/${chart_parts[0]}"/"${chart_parts[1]}/Chart.yaml" ]; then
      #           ./hack/renovate-releasenotes.sh "charts/${chart_parts[0]}"/"${chart_parts[1]}"
      #         fi
      #         echo ""
      #         cat "charts/${chart_parts[0]}"/"${chart_parts[1]}/Chart.yaml"
      #     done

    # - name: Create commit
    #   if: steps.filter.outputs.addedOrModified == 'true'
    #   uses: stefanzweifel/git-auto-commit-action@v4
    #   with:
    #     push_options: --force
    #     commit_message: Auto-generate chart README

    #     commit_user_name: ${{ github.actor }}
    #     commit_user_email: ${{ github.actor }}@users.noreply.github.com

    #     file_pattern: charts/**/
