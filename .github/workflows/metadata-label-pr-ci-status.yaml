---
name: "Metadata: Label pull requests CI status"

on:
  workflow_run:
    workflows:
    - "Pre-commit consistency check"
    types:
    - completed

jobs:
  label-precommit:
    name: Label pre-commit status
    runs-on: ubuntu-20.04
    # if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
    - uses: getsentry/action-github-app-token@v1
      id: get-app-token
      with:
        app_id: ${{ secrets.K8S_AT_HOME_APP_ID }}
        private_key: ${{ secrets.K8S_AT_HOME_APP_PRIVATE_KEY }}

    - uses: hmarr/debug-action@v2

    # # CI Passed
    # - name: "add label: ok"
    #   uses: actions-ecosystem/action-add-labels@v1
    #   if: ${{ github.event.workflow_run.conclusion == 'success' }}
    #   with:
    #     github_token: ${{ steps.get-app-token.outputs.token }}
    #     labels: "precommit:ok"

    # - name: "remove label: failed"
    #   uses: actions-ecosystem/action-remove-labels@v1
    #   if: ${{ github.event.workflow_run.conclusion == 'success' }}
    #   with:
    #     github_token: ${{ steps.get-app-token.outputs.token }}
    #     labels: "precommit:failed"

    # # CI Failed
    # - name: "add label: failed"
    #   uses: actions-ecosystem/action-add-labels@v1
    #   if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    #   with:
    #     github_token: ${{ steps.get-app-token.outputs.token }}
    #     labels: "precommit:failed"

    # - name: "remove label: ok"
    #   uses: actions-ecosystem/action-remove-labels@v1
    #   if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    #   with:
    #     github_token: ${{ steps.get-app-token.outputs.token }}
    #     labels: "precommit:ok"
